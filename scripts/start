#!/usr/bin/env bash

function start_minecraft()
{
    cd /data/runtime || exit 1
    exec java -server -Xms128M -jar /data/runtime/minecraft_server.jar nogui
}

if [[ -f /data/runtime/server.properties ]]; then
    start_minecraft
else
    echo "stop" | start_minecraft
    MCRCON_PASS="$(ruby -rsecurerandom -e 'puts SecureRandom.hex(20)')"
    sed -i '/white-list=.*/d' /data/runtime/server.properties
    sed -i '/enable-rcon=.*/d' /data/runtime/server.properties
    tee -a /data/runtime/server.properties >/dev/null <<EOS
white-list=true
enable-rcon=true
rcon.password=$MCRCON_PASS
EOS
    (sleep 10; /scripts/mcrcon -p "$MCRCON_PASS" "op xucheng") &
    start_minecraft
fi

